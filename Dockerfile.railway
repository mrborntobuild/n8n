# Use official n8n image
FROM n8nio/n8n:latest

# Railway requires a non-root user
USER root

# Create directories
RUN mkdir -p /home/node/.n8n && \
    chown -R node:node /home/node

# Switch back to node user
USER node

# Set n8n to listen on Railway's PORT
ENV N8N_PORT=5678
ENV NODE_ENV=production

EXPOSE 5678

# Use the official entrypoint
ENTRYPOINT ["tini", "--", "/docker-entrypoint.sh"]